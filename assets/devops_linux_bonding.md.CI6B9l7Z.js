import{_ as s,c as a,o as n,a5 as i}from"./chunks/framework.ByOCcFwP.js";const g=JSON.parse('{"title":"Linux网卡绑定(聚合)","description":"","frontmatter":{"title":"Linux网卡绑定(聚合)","date":"2023-06-05T17:28:02.000Z","categories":"linux","tags":["linux","bonding","lacp"]},"headers":[],"relativePath":"devops/linux/bonding.md","filePath":"devops/linux/bonding.md"}'),e={name:"devops/linux/bonding.md"},p=i(`<h2 id="bond模式" tabindex="-1">bond模式 <a class="header-anchor" href="#bond模式" aria-label="Permalink to &quot;bond模式&quot;">​</a></h2><table><thead><tr><th>bonding模式</th><th>对应switch配置</th></tr></thead><tbody><tr><td>mode=0, (balance-rr) 平衡轮询模式</td><td>LACP mode on, 强制链路聚合</td></tr><tr><td>mode=1, (active-backup) 主备模式</td><td>access端口, 无需特别配置</td></tr><tr><td>mode=2, (balance-xor) hash均衡模式</td><td>LACP mode on, 强制链路聚合</td></tr><tr><td>mode=3, (brodcast) 广播模式</td><td>LACP mode on, 强制链路聚合</td></tr><tr><td>mode=4, (IEEE802.3ad) 动态链路聚合模式</td><td>LACP动态协商, 建议主动模式</td></tr><tr><td>mode=5, (balance-tlb) 发送负载均衡模式</td><td>access端口, 无需特别配置</td></tr><tr><td>mode=6, (balance-alb) 接收负载均衡模式</td><td>access端口, 无需特别配置</td></tr></tbody></table><h2 id="nmcli命令创建bond接口" tabindex="-1">nmcli命令创建bond接口 <a class="header-anchor" href="#nmcli命令创建bond接口" aria-label="Permalink to &quot;nmcli命令创建bond接口&quot;">​</a></h2><h3 id="创建bond接口并配置地址" tabindex="-1">创建bond接口并配置地址 <a class="header-anchor" href="#创建bond接口并配置地址" aria-label="Permalink to &quot;创建bond接口并配置地址&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmcli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> con</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> con-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ifname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond.options</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mode=active-backup&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmcli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethernet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> slave-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> con-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0-port1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ifname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ens33</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmcli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethernet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> slave-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> con-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0-port2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ifname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ens34</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmcli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> con</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> modify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipv4.addresses</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;192.168.1.200/24&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipv4.gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipv4.method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manual</span></span></code></pre></div><h3 id="生成的配置文件如下" tabindex="-1">生成的配置文件如下 <a class="header-anchor" href="#生成的配置文件如下" aria-label="Permalink to &quot;生成的配置文件如下&quot;">​</a></h3><h4 id="ifcfg-bond0" tabindex="-1"><code>ifcfg-bond0</code> <a class="header-anchor" href="#ifcfg-bond0" aria-label="Permalink to &quot;\`ifcfg-bond0\`&quot;">​</a></h4><div class="language-conf vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>BONDING_OPTS=mode=active-backup</span></span>
<span class="line"><span>TYPE=Bond</span></span>
<span class="line"><span>BONDING_MASTER=yes</span></span>
<span class="line"><span>PROXY_METHOD=none</span></span>
<span class="line"><span>BROWSER_ONLY=no</span></span>
<span class="line"><span>DEFROUTE=yes</span></span>
<span class="line"><span>IPV4_FAILURE_FATAL=no</span></span>
<span class="line"><span>IPV6INIT=yes</span></span>
<span class="line"><span>IPV6_AUTOCONF=yes</span></span>
<span class="line"><span>IPV6_DEFROUTE=yes</span></span>
<span class="line"><span>IPV6_FAILURE_FATAL=no</span></span>
<span class="line"><span>IPV6_ADDR_GEN_MODE=stable-privacy</span></span>
<span class="line"><span>NAME=bond0</span></span>
<span class="line"><span>UUID=432d4cd2-6ea7-4b8a-a9cf-9f82a1f758b2</span></span>
<span class="line"><span>DEVICE=bond0</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>IPADDR=192.168.1.200</span></span>
<span class="line"><span>PREFIX=24</span></span>
<span class="line"><span>GATEWAY=192.168.1.1</span></span></code></pre></div><h4 id="ifcfg-bond0-port1" tabindex="-1"><code>ifcfg-bond0-port1</code> <a class="header-anchor" href="#ifcfg-bond0-port1" aria-label="Permalink to &quot;\`ifcfg-bond0-port1\`&quot;">​</a></h4><div class="language-conf vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>NAME=bond0-port1</span></span>
<span class="line"><span>UUID=bd8fd4f8-2d59-41ec-9972-87c862364651</span></span>
<span class="line"><span>DEVICE=ens33</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>MASTER=bond0</span></span>
<span class="line"><span>SLAVE=yes</span></span></code></pre></div><h4 id="ifcfg-bond0-port2" tabindex="-1"><code>ifcfg-bond0-port2</code> <a class="header-anchor" href="#ifcfg-bond0-port2" aria-label="Permalink to &quot;\`ifcfg-bond0-port2\`&quot;">​</a></h4><div class="language-conf vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>NAME=bond0-port2</span></span>
<span class="line"><span>UUID=64027180-3fc2-435b-b571-b909409136c4</span></span>
<span class="line"><span>DEVICE=ens34</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>MASTER=bond0</span></span>
<span class="line"><span>SLAVE=yes</span></span></code></pre></div><ul><li><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/sec-network_bonding_using_the_networkmanager_command_line_tool_nmcli" target="_blank" rel="noreferrer">7.3. 使用 NetworkManager 命令行工具 nmcli 进行网络绑定 Red Hat Enterprise Linux 7 | Red Hat Customer Portal</a></li></ul><h2 id="修改配置文件创建-bond-接口" tabindex="-1">修改配置文件创建 bond 接口 <a class="header-anchor" href="#修改配置文件创建-bond-接口" aria-label="Permalink to &quot;修改配置文件创建 bond 接口&quot;">​</a></h2><h3 id="_1-修改bond配置" tabindex="-1">1.修改bond配置 <a class="header-anchor" href="#_1-修改bond配置" aria-label="Permalink to &quot;1.修改bond配置&quot;">​</a></h3><p>以 mode 0 为例</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>modprobe bonding miimon=100 mode=0</span></span>
<span class="line"><span>echo &quot;alias bond0 bonding&quot; &gt;&gt; /etc/modprobe.d/bond.conf</span></span>
<span class="line"><span>echo &quot;options bond0 miimon=100 mode=0&quot; &gt;&gt; /etc/modprobe.d/bond.conf</span></span></code></pre></div><p><strong>miimon是用来进行链路监测, miimon=100 表示系统每100ms监测一次链路连接状态，如果有一条线路不通就转入另一条线路</strong></p><h3 id="_2-修改网卡配置文件" tabindex="-1">2.修改网卡配置文件 <a class="header-anchor" href="#_2-修改网卡配置文件" aria-label="Permalink to &quot;2.修改网卡配置文件&quot;">​</a></h3><p>在 <code>/etc/sysconfig/network-scripts</code> 新建bond口聚合网卡配置文件<code>ifcfg-bond0</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>NAME=bond0                                #网卡名称为bond0</span></span>
<span class="line"><span>BOOTPROTO=static                          #配置静态ip</span></span>
<span class="line"><span>USERCTL=no                                #禁止非root用户管理此网卡</span></span>
<span class="line"><span>ONBOOT=yes                                #网络服务启动激活此网卡连接</span></span>
<span class="line"><span>TYPE=Bond                                 #网络类型为Bond</span></span>
<span class="line"><span>BONDING_MASTER=yes                        #作为bond的管理设备</span></span>
<span class="line"><span>BONDING_OPTS=&quot;mode=0 miimon=100&quot;          #bond配置</span></span>
<span class="line"><span>IPADDR=192.168.1.128                      #ip地址</span></span>
<span class="line"><span>NETMASK=255.255.255.0                     #掩码</span></span>
<span class="line"><span>GATEWAY=192.168.1.1                       #网关</span></span></code></pre></div><p>编辑需要作为 bond0 的 slave 设备配置文件</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>NAME=ens32</span></span>
<span class="line"><span>DEVICE=ens32</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>USERCTL=no</span></span>
<span class="line"><span>MASTER=bond0</span></span>
<span class="line"><span>SLAVE=yes</span></span></code></pre></div><h3 id="_3-重启networkmanager服务" tabindex="-1">3.重启NetworkManager服务 <a class="header-anchor" href="#_3-重启networkmanager服务" aria-label="Permalink to &quot;3.重启NetworkManager服务&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>systemctl restart NetworkManager</span></span></code></pre></div><p><strong>若重启NetworkManager未生效则需要重启Linux系统</strong></p><h2 id="删除bond接口" tabindex="-1">删除bond接口 <a class="header-anchor" href="#删除bond接口" aria-label="Permalink to &quot;删除bond接口&quot;">​</a></h2><h3 id="_1-删除bond0配置文件" tabindex="-1">1.删除bond0配置文件 <a class="header-anchor" href="#_1-删除bond0配置文件" aria-label="Permalink to &quot;1.删除bond0配置文件&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>rm -rf /etc/sysconfig/netwrok-scripts/ifcfg-bond0</span></span>
<span class="line"><span>rm -rf /etc/modprobe.d/bond.conf</span></span></code></pre></div><h3 id="_2-修改网卡配置文件-1" tabindex="-1">2.修改网卡配置文件 <a class="header-anchor" href="#_2-修改网卡配置文件-1" aria-label="Permalink to &quot;2.修改网卡配置文件&quot;">​</a></h3><p>删除作为 slave 网卡配置的 bond 相关参数(<code>MASTER=bond0</code> <code>SLAVE=yes</code>)</p><h3 id="_3-卸载bonding模块" tabindex="-1">3.卸载bonding模块 <a class="header-anchor" href="#_3-卸载bonding模块" aria-label="Permalink to &quot;3.卸载bonding模块&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>rmmod bonding</span></span></code></pre></div><h3 id="_4-重启网络服务" tabindex="-1">4.重启网络服务 <a class="header-anchor" href="#_4-重启网络服务" aria-label="Permalink to &quot;4.重启网络服务&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>systemctl restart NetworkManager</span></span></code></pre></div>`,35),t=[p];function l(o,d,h,c,r,k){return n(),a("div",null,t)}const F=s(e,[["render",l]]);export{g as __pageData,F as default};
